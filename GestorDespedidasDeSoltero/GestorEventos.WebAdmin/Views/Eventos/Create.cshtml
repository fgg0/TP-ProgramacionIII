

@model GestorEventos.Servicios.Entidades.EventoModel

@{
    ViewData["Title"] = "Administrador - Crear evento | FarewellFest";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://localhost:7233/css/site.css">
}

<header>
    <div class="container">
        <a href="/" class="logo">
            <img src="https://localhost:7233/images/logo.png" alt="FarewellFest Logo">
        </a>
        <a href="/" class="logo-text">FarewellFest</a>
        <nav>
            <ul>
                <li><a href="/Eventos"><i class="fa-solid fa-backward"></i>&nbsp;&nbsp;Volver hacia atrás</a></li>
                <li><a href="/Servicios"><i class="fa-solid fa-spa"></i>&nbsp;&nbsp;Administrar servicios</a></li>
                <li><a href="/Eventos"><i class="fa-solid fa-calendar-days"></i></i>&nbsp;&nbsp;Administrar eventos</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="container">
        <h1 class="page-title">Reservar un nuevo evento</h1>
        <form asp-action="Create" class="event-form">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label asp-for="NombreEvento" class="control-label">
                    <i class="fa-solid fa-file-signature"></i>
                    <span>Nombre del evento:</span>
                </label>
                <input asp-for="NombreEvento" class="form-control" placeholder="Despedida de soltero de Esteban" id="NombreEvento" />
                <span asp-validation-for="NombreEvento" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="FechaEvento" class="control-label">
                    <i class="fa-solid fa-calendar"></i>
                    <span>Fecha del evento:</span>
                </label>
                <input asp-for="FechaEvento" class="form-control" type="date" id="fechaEvento" />
                <span asp-validation-for="FechaEvento" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="CantidadPersonas" class="control-label">
                    <i class="fa-solid fa-users"></i>
                    <span>Cantidad de personas:</span>
                </label>
                <input asp-for="CantidadPersonas" class="form-control" type="number" min="1" />
                <span asp-validation-for="CantidadPersonas" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="IdTipoEvento" class="control-label">
                    <i class="fa-solid fa-list"></i>
                    <span>Tipo de evento:</span>
                </label>
                <select asp-for="IdTipoEvento" class="form-control">
                    <option value="1">Fiesta</option>
                    <option value="2">Salida al río</option>
                    <option value="3">Tarde de Spa</option>
                    <option value="4">Actividades deportivas</option>
                </select>
                <span asp-validation-for="IdTipoEvento" class="text-danger"></span>
            </div>

            <div class="form-box">
                <h2 class="box-title"><i class="fa-solid fa-address-book"></i>&nbsp;&nbsp;Datos de contacto</h2>
                <div class="form-group">
                    <label asp-for="Nombre" class="control-label">Nombre</label>
                    <input asp-for="Nombre" class="form-control" placeholder="Escribí tu nombre" />
                    <span asp-validation-for="Nombre" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Apellido" class="control-label">Apellido</label>
                    <input asp-for="Apellido" class="form-control" placeholder="Escribí tu apellido" />
                    <span asp-validation-for="Apellido" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Direccion" class="control-label">Dirección</label>
                    <input asp-for="Direccion" class="form-control" placeholder="Escribí tu dirección" />
                    <span asp-validation-for="Direccion" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Telefono" class="control-label">Teléfono</label>
                    <input asp-for="Telefono" class="form-control" placeholder="Escribí tu número de teléfono" />
                    <span asp-validation-for="Telefono" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Email" class="control-label">Correo electrónico</label>
                    <input asp-for="Email" class="form-control" type="email" placeholder="Escribí tu correo electrónico" />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>
            </div>

            <div class="form-box">
                <h2 class="box-title"><i class="fa-solid fa-spa"></i>&nbsp;&nbsp;Servicios disponibles</h2>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Servicio</th>
                            <th>Precio</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var servicio in Model.ListaDeServiciosDisponibles)
                        {
                            <tr>
                                <td>
                                    <input type="checkbox" name="Servicio" value="@servicio.IdServicio" class="service-checkbox" />
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => servicio.Descripcion)
                                </td>
                                <td>
                                    $@(((int)servicio.PrecioServicio).ToString("N0").Replace(",", "."))
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="form-box" id="cart">
                <h2 class="box-title"><i class="fa-solid fa-cart-shopping"></i>&nbsp;&nbsp;Carrito</h2>
                <ul id="cart-items">
                    <li id="costo-fijo">Costo fijo del evento - $300.000</li>
                </ul>
                <p class="cart-total">Total: $<span id="cart-total">300.000</span></p>
            </div>

            <div class="form-group submit-group">
                <input type="submit" value="Enviar evento" class="service-btn" />
            </div>
        </form>
    </div>
</main>

@section Scripts {
    @{
        <script src="https://localhost:7233/js/site.js"></script>
    }

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const checkboxes = document.querySelectorAll('.service-checkbox');
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            let total = 300000; // Inicializamos con el costo fijo del evento

            function formatPrice(price) {
                return Math.round(price).toLocaleString('es-AR').replace(',', '.');
            }

            cartTotal.textContent = formatPrice(total); // Mostramos el costo fijo inicial formateado

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    const row = this.closest('tr');
                    const serviceName = row.cells[1].textContent.trim();
                    const servicePrice = parseInt(row.cells[2].textContent.trim().replace('$', '').replace('.', ''));

                    if (this.checked) {
                        total += servicePrice;
                        const li = document.createElement('li');
                        li.textContent = `${serviceName} - $${formatPrice(servicePrice)}`;
                        li.dataset.price = servicePrice;
                        cartItems.appendChild(li);
                    } else {
                        total -= servicePrice;
                        const items = cartItems.getElementsByTagName('li');
                        for (let item of items) {
                            if (item.textContent.includes(serviceName)) {
                                cartItems.removeChild(item);
                                break;
                            }
                        }
                    }

                    cartTotal.textContent = formatPrice(total);
                });
            });

            // Establecer la fecha actual como placeholder para el campo de fecha del evento
            const fechaEventoInput = document.getElementById('fechaEvento');
            const fechaActual = new Date().toISOString().split('T')[0];
            fechaEventoInput.setAttribute('min', fechaActual);
            fechaEventoInput.value = fechaActual;
        });
    </script>
}